const express = require("express");
const cors = require("cors");
const { default: fetch } = require("node-fetch");
require("dotenv").config();

//custom functions
const createSignature = require("./utils/createSignature");

const app = express();
const port = process.env.PORT || 4000;
app.listen(port, () => console.log(`listening on port ${port}`));
app.use(
  cors({
    origin: "http://localhost:3000",
  })
);
const apiUrl = "https://api.smitegame.com/smiteapi.svc";

//server ping, returns timestamp
app.get("/api", (req, resp) => {
  try {
    console.log("I got a ping!");
    const timeStamp = Date.now();
    resp.json(timeStamp);
  } catch (error) {
    console.log(error);
  }
});

//ping the smite api
app.get("/smiteapi", async (req, resp) => {
  try {
    console.log("I got a smite ping!");
    const devId = process.env.devId;
    const authKey = process.env.authKey;
    const smitePingUrl = `${apiUrl}/pingjson`;
    const smitePingCall = await fetch(smitePingUrl);
    const data = await smitePingCall.json();
    resp.json(data);
  } catch (error) {
    console.log(error);
  }
});

app.get("/createsession", async (req, resp) => {
  try {
    console.log("createSession");
    const signature = createSignature();
    resp.json(signature);
  } catch (error) {
    console.log(error);
  }
});
